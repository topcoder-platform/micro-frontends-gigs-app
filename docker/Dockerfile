# Use the base image with Node.js
FROM node:10.24

ARG APPMODE
ARG APPENV
ARG HEAP_ANALYTICS_KEY
ARG RECRUIT_API
ARG AUTH_SECRET
ARG VALID_ISSUERS
ARG AUTH0_URL
ARG AUTH0_AUDIENCE
ARG AUTH0_CLIENT_ID
ARG AUTH0_CLIENT_SECRET
ARG AUTH0_PROXY_SERVER_URL
ARG M2M_AUDIT_USER_ID
ARG M2M_AUDIT_HANDLE

ENV APPMODE=$APPMODE
ENV APPENV=$APPENV
ENV HEAP_ANALYTICS_KEY=$HEAP_ANALYTICS_KEY
ENV RECRUIT_API=$RECRUIT_API
ENV AUTH_SECRET=$AUTH_SECRET
ENV VALID_ISSUERS=$VALID_ISSUERS
ENV AUTH0_URL=$AUTH0_URL
ENV AUTH0_AUDIENCE=$AUTH0_AUDIENCE
ENV AUTH0_CLIENT_ID=$AUTH0_CLIENT_ID
ENV AUTH0_CLIENT_SECRET=$AUTH0_CLIENT_SECRET
ENV AUTH0_PROXY_SERVER_URL=$AUTH0_PROXY_SERVER_URL
ENV M2M_AUDIT_USER_ID=$M2M_AUDIT_USER_ID
ENV M2M_AUDIT_HANDLE=$M2M_AUDIT_HANDLE

RUN echo "Env Set :: "
RUN echo $APPMODE
RUN echo $APPENV
RUN echo $HEAP_ANALYTICS_KEY

# Copy the current directory into the Docker image
COPY . /micro-frontends-gigs-app

# Set working directory for future use
WORKDIR /micro-frontends-gigs-app

# Install the dependencies from package.json
RUN npm install

RUN npm run build

CMD npm start
